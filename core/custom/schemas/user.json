{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://tmi-platform.org/schemas/user.json",

  "definitions": {
    "uei": {"$ref": "http://minimi.org/schemas/fields.json#/definitions/uei"},
    "email": {"$ref": "http://minimi.org/schemas/fields.json#/definitions/email"},
    "password": {"$ref": "http://minimi.org/schemas/fields.json#/definitions/password"},
    "exposure": {"$ref": "http://tmi-platform.org/schemas/fields.json#/definitions/exposure"}
  },

  "type": "object",
  "title": "User",

  "properties": {

    "id":  {
      "allOf": [
        {"$ref": "#/definitions/uei"},
        {
          "title": "User ID",
          "description": "Unique user identifier"
        }
      ],
      "isUniqueKey": true
    },

    "username":  {
      "title": "Username",
      "description": "Unique chosen name of the user",
      "type": "string",
      "allOf":[
        {"minLength": 1, "errorMessage": "should be more than 1 character"},
        {"maxLength": 100, "errorMessage": "should be less than 100 characters"}
      ],
      "isUniqueKey": true
    },

    "email":  {
      "title": "Email",
      "description": "Email address used for login retrieval and notification",
      "type": "object",
      "properties": {
        "value": {"$ref": "#/definitions/email"},
        "privacy": {
          "allOf": [
            {"$ref": "#/definitions/exposure"},
            {
              "not": {
                "enum": ["anyone"]
              },
              "errorMessage": "Unacceptible level of exposure."
            }
          ]
        }
      },
      "required": ["value", "privacy"],
      "isUniqueKey": true,
      "processors": {
        "raw": {"value": "LOWERCASE"}
      }
    },

    "password":  {"$ref": "#/definitions/password"}
  },

  "required": ["username", "email", "password"],

  "processors": {
    "validated": {"password": "HASH"},
    "committed": {"password": "BLANK"},
    "retrieved": {"password": "BLANK"}
  }
}
